#!/bin/sh

# Arguments supplied by the build system
BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

# Determine the directory of this buildpack
BUILDPACK_DIR=$(cd $(dirname $0) && cd .. && pwd)

echo "-----> Installing Microsoft ODBC Driver..."

# Create a directory for ODBC drivers
mkdir -p $BUILD_DIR/.odbc

# Copy the precompiled driver and resource files
cp $BUILDPACK_DIR/libmsodbcsql-17.5.so.2.1 $BUILD_DIR/.odbc/
cp $BUILDPACK_DIR/msodbcsqlr17.rll $BUILD_DIR/.odbc/

# Set environment variables
echo "export LD_LIBRARY_PATH=\"\$LD_LIBRARY_PATH:$BUILD_DIR/.odbc\"" > $BUILD_DIR/.profile.d/odbc.sh

# If you have an odbcinst.ini, set it up
cp $BUILDPACK_DIR/odbcinst.ini $BUILD_DIR/.odbc/
echo "export ODBCSYSINI=$BUILD_DIR/.odbc" >> $BUILD_DIR/.profile.d/odbc.sh
echo "export ODBCINI=$BUILD_DIR/.odbc/odbcinst.ini" >> $BUILD_DIR/.profile.d/odbc.sh

echo "-----> ODBC Driver setup completed."
